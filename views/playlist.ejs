<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>My Playlists</title>
  </head>
  <body>
    <h1>üéµ My Playlists</h1>
    <div id="playlist-container"></div>

    <script>
      async function loadPlaylists() {
        const token = localStorage.getItem("token");
        const res = await fetch("/api/playlists", {
          headers: { Authorization: "Bearer " + token },
        });
        const data = await res.json();

        const container = document.getElementById("playlist-container");
        data.playlists.forEach((p) => {
          const div = document.createElement("div");
          div.innerHTML = `
          <h2>${p.name}</h2>
          <ul>
            ${p.songs
              .map(
                (s) => `<li>${s.title} - ${s.artist} 
              <button onclick="playSong('${s._id}')">Play ‚ñ∂Ô∏è</button>
            </li>`
              )
              .join("")}
          </ul>
        `;
          container.appendChild(div);
        });
      }

      async function playSong(id) {
        const res = await fetch(`/api/playlists/play/${id}`);
        const data = await res.json();
        if (data.success && data.previewUrl) {
          const audio = new Audio(data.previewUrl);
          audio.play();
        } else {
          alert("No preview available for this song");
        }
      }

      loadPlaylists();
    </script>
  </body>
</html>
